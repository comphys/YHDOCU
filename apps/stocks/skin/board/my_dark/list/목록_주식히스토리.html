{% extends D['_skn'] + 'board/my_dark/main_layout.html' %}

{% block contents_list %}

	<div class="my-box">
		<div class="my-box-inner">
			전체 : {{D['ot'][0]}}일 &nbsp; 상승 {{D['ot'][1]}}( {{D['ot'][2]}}% ) 하락 {{D['ot'][3]}}( {{D['ot'][4]}}% )&nbsp; 
			최근 1년 : {{D['ot1'][0]}}일 상승 {{D['ot1'][1]}}( {{D['ot1'][2]}}% ) 하락 {{D['ot1'][3]}}( {{D['ot1'][4]}}% )&nbsp;<span id="qty-pcnt" class="list-bear-cnt"></span><br>
			<table class="table table-bordered table-striped" style="text-align:right;margin-top:10px;">
				<tr style="background-color:#0A2229;font-weight:bold;">
					<td>연속하락</td><td>C1</td><td>C2</td><td>C3</td><td>C4</td><td>C5</td><td>C6</td><td>C7</td><td>C8</td>
				</tr>
				<tr>
					<td>전체</td><td>{{D['ot'][7]}}</td><td>{{D['ot'][9]}}</td><td>{{D['ot'][11]}}</td><td>{{D['ot'][13]}}</td><td>{{D['ot'][15]}}</td><td>{{D['ot'][17]}}</td><td>{{D['ot'][19]}}</td><td>{{D['ot'][21]}}</td>
				</tr>
				<tr>
					<td>비율</td><td data-pcnt="off">{{D['ot'][8]}}</td><td data-pcnt="off">{{D['ot'][10]}}</td><td data-pcnt="off">{{D['ot'][12]}}</td><td data-pcnt="off">{{D['ot'][14]}}</td>
					<td data-pcnt="off">{{D['ot'][16]}}</td><td data-pcnt="off">{{D['ot'][18]}}</td><td data-pcnt="off">{{D['ot'][20]}}</td><td data-pcnt="off">{{D['ot'][22]}}</td>
				</tr>
				<tr>
					<td>최근일년</td><td>{{D['ot1'][7]}}</td><td>{{D['ot1'][9]}}</td><td>{{D['ot1'][11]}}</td><td>{{D['ot1'][13]}}</td><td>{{D['ot1'][15]}}</td><td>{{D['ot1'][17]}}</td><td>{{D['ot1'][19]}}</td><td>{{D['ot1'][21]}}</td>
				</tr>
				<tr>
					<td>비율</td><td data-pcnt="off">{{D['ot1'][8]}}</td><td data-pcnt="off">{{D['ot1'][10]}}</td><td data-pcnt="off">{{D['ot1'][12]}}</td><td data-pcnt="off">{{D['ot1'][14]}}</td>
					<td data-pcnt="off">{{D['ot1'][16]}}</td><td data-pcnt="off">{{D['ot1'][18]}}</td><td data-pcnt="off">{{D['ot1'][20]}}</td><td data-pcnt="off">{{D['ot1'][22]}}</td>
				</tr>
			</table>
		</div>
	</div>

<!-- 리스트 상부 카테고리 시작 -->
<div class="clearfix" style='margin:10px 0px 5px 0px'>
{% if D['Cat_use'] %}
	<div class="pull-left">
		<form method='post' name='category_search' action="{{D['_bse']}}board/list/{{D['bid']}}" style='display:inline;'>
			{%- for cats in D['CAT_LIST'] %}
			<div class='myselect' style='margin-right:5px;'>
				{%- if cats['chked'] %}
				<input placeholder="{{cats['title']}}" name="csh_{{cats['fkey']}}" id="{{cats['id']}}" type="text" style="color:black;width:100px;background-color:#b5daff" value="{{cats['value']}}" />
				{%- else %}
				<input placeholder="{{cats['title']}}" name="csh_{{cats['fkey']}}" id="{{cats['id']}}" type="text" style="width:100px" value="{{cats['value']}}" />
				{%- endif %}
				<div class='btn-group'>
					<button class="btn btn-select dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
					<ul class='dropdown-menu'>
						<li><a> {{cats['title']}} </a></li>
						{%- for li in cats['lists'] %}
						<li><a href="#"> {{li[0]}} </a></li>
						{% endfor -%}
					</ul>
				</div>
			</div>
			{% endfor -%}
			<input type="hidden" name="list_filter" value="{{D['list_filter']}}" >
		</form>
		<span style="color:gray">{{D['TimeNow']}}&nbsp;</span>
		<a href="javascript:winopen('winopen/chart',820,450,'stock_chart')" style='color:gray'><i class='fa fa-bar-chart fa-lg' title=""></i></a>
	</div>
{% endif -%}
	<div class='pull-right'>
		<div class='select' style='margin-right:5px;'>
			<span id="cell-sum"></span>
			<input placeholder="검색항목" name="search_field" type="text" style="width:100px" value="{{D['search_f']}}" />
			<div class='btn-group'>
				<button class="btn btn-select dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
				<ul class='dropdown-menu'>
					<li><a> 검색항목 </a></li>
					{% for key, val in D['EXTITLE'].items() -%}
					<li><a href="#"> {{val}}</a></li>
                    {% endfor -%}
					<li><a href="#"> 본 문 </a></li>
				</ul>
			</div>
		</div>

		<input  id="search_input2" type='text' name='search_value' value="{{D['search']}}" style='height:24px;vertical-align:baseline' />
		<button class='btn btn-black btn-small' style="height:25px;vertical-align:top;" onclick="list_search2()">검색</button>
		<button class='btn btn-black btn-small' style="height:25px;vertical-align:top;" onclick="location.href='{{D['_bse']}}board/list/{{D['bid']}}/csh=on'" >취소</button>
	</div>
</div>
<!-- 리스트 상부 카테고리 종료 -->

<!-- 리스트 메인 테이블 시작 -->

{% if D['TR'] %}
<div class="row-row clearfix"> 

	<table class='table table-bordered table-striped table-hover'>
		<thead>
			<tr>
				{% for key,val in D['head_td'].items() %}
				{{val|safe}}
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% if D['BCONFIG']['row_flt'] == 'on' %}
			<tr id="list-filter" {{ "" if D['list_filter'] else "style='display:none'"|safe }}>{{D['row_flt']|safe}}</tr>
			{% endif %}
			{% if D['BCONFIG']['row_sum'] == 'on' %}
			<tr id="list-sum">{{D['row_sum']|safe}}</tr>
			{% endif %}
			{%- for TR in D['TR'] -%}
			{% if loop.index0 == D['cno'] %}
			<tr class="list-current-tr">
			{% else %}
			<tr> 
			{% endif %}
			{% for key,val in TR.items() %}
			{{val|safe}}
			{% endfor %}
			</tr>
			{%- endfor %}
		</tbody>
	</table>
</div>
{% else %}
<div class="row-row clearfix"> 
	<div class='well'><strong>안내사항 :</strong> 현재 작성된 글이 없거나 검색결과에 일치하는 데이타가 없습니다.  </div> 
</div>
{% endif %}
<!-- 리스트 메인 테이블 종료 -->

<!-- 하단 버튼 [ 목록 쓰기] [페이지네이션]-->
<div class="row-row clearfix">
	<div class='pull-left'>
		{% if not D['업데이트'] %}
		<button class='btn btn-small btn-red' onclick="update_stockPrice()">주가 업데이트</button>
		{% endif %}
		<a href="{{D['_bse']}}board/write/{{D['bid']}}{{D['Searchplus']}}"><button class='btn btn-small btn-red'>직접입력</button></a>
	</div>
	<div class='pagination pull-right'><ul>
		{{D['Pagination']|safe}}
	</ul></div>
</div>

<script>
function add_newstock() { 
	var new_stock = $("input[name='add_new_stock']").val();
	if(! new_stock ) return;
	h_dialog.alert("일시적으로 중단된 상태입니다."); return;
	var url = uri('linkurl') + 'boards-stock_update/update_stock/' + new_stock ;
	location.href = url; 
}

function del_oldstock() { 
	var old_stock = $("input[name='add_new_stock']").val();
	if(! old_stock ) return;
	var url = uri('linkurl') + 'boards-stock_update/delete/' + old_stock ;
	location.href = url; 
}

$(".list-code").click(function(){
	var code = $(this).text()
	winopen('winopen/chart2/'+code,820,450,'stock_chart');
});

$("[data-pcnt]").click(function()
	{ 
		var s_swt = $(this).data("pcnt");
		var s_sum = parseFloat($("#qty-pcnt").text()); if(isNaN(s_sum)) s_sum = 0;
		var s_val = parseFloat($(this).text()); 
	
		if(s_swt == 'off') {
			$(this).addClass("q-addvalue").data("pcnt","on");
			$(this).prev().addClass("list-bear-cnt");
			s_sum = Number(s_sum) + Number(s_val);
		} else {
			$(this).removeClass("q-addvalue").data("pcnt","off");
			$(this).prev().removeClass("list-bear-cnt");
			s_sum = Number(s_sum) - Number(s_val);
		}
		if(s_sum) {
			var ss = s_sum.toFixed(2); $("#qty-pcnt").text(ss);
		} else { $("#qty-pcnt").text('');}

	}
);

// Ajax

function update_stockPrice() {
	posturl = uri('linkajax') + "stockHistory/update_stock"
	$.post(posturl, {}, null, 'json' ).done(function(data){ 

		if(data=='OK') {location.reload(); h_dialog.notice("주가 정보가 업데이트 되었습니다")}
		else {h_dialog.notice(data);}
	});
}

</script>

{% endblock %}