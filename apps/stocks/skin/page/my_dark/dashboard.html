{% extends D['_skn'] + 'page/my_dark/main_layout_mobile.html' %}

{% block contents_page  %}
<div>
<div style='font-size:16px;color:#f0f0ab;font-weight:bold;text-align:center'>
{{D['오늘날자']}}({{D['오늘요일']}}) 투자현황 및 전략
</div>
<div style='font-size:14px;color:gray;font-weight:bold;text-align:center;'>
  {% if D['투자안내'] %}
  투자전략 가이드가 업데이트 되지 않았습니다
  {% else %}
  최종 종가 {{D['기준종가']}} ({{D['기준일자']}})
  {% endif %}
</div>
{% if D['투자안내'] %}
<div style='font-size:12px;color:orange;font-weight:bold;margin-bottom:10px;text-align:center'>
  투자전략 가이드가 업데이트 되지 않았습니다
</div>
{% endif %}

<div style="border:2px solid black;margin-top:10px;">
	<canvas id="myChart_side"  style="width:355px;height:200px;background-color:#24272d;padding:5px 10px"></canvas>
</div>

<div style="font-size:14px;font-weight:700;line-height:30px;border:2px solid black;padding:5px 10px;background-color:black;margin-top:10px;">
    <span style="color:white"> 투자일지(키움증권)</span>&nbsp;<span style='font-weight:400;font-style:italic;color:#f0f0ab;'>{{D['현수익률1']}} % , {{D['매도시점1']}} % up to sell</span>
    <span style="color:#f0f0ab"> {{D['키움증권']}} </span><br>
    <table>
        <tr>
            <td style="width:70px;color:#58ACFA">매수전략</td>
            <td style="width:60px;text-align:right">{{D['매수수량1']}}</td>
            <td style="width:80px;text-align:right">{{D['매수가격1']}}</td>
            <td style="width:100px;text-align:right">{{D['매수가액1']}}</td>
        </tr>
        <tr>
            <td style="width:70px;color:#f78181">매도전략</td>
            <td style="width:60px;text-align:right">{{D['매도수량1']}}</td>
            <td style="width:80px;text-align:right">{{D['매도가격1']}}</td>
            <td style="width:100px;text-align:right">{{D['매도가액1']}}</td>
        </tr>
    </table>
</div>

<div style="font-size:14px;font-weight:700;line-height:30px;border:2px solid black;padding:5px 10px;background-color:black;margin-top:10px;">
    <span style="color:white"> 투자일지(하이투자) </span>&nbsp;<span style='font-weight:400;font-style:italic;color:#f0f0ab;'>{{D['현수익률2']}} % , {{D['매도시점2']}} % up to sell</span>
    <span style="color:#f0f0ab"> {{D['하이투자']}} </span><br>
    <table>
        <tr>
            <td style="width:70px;color:#58ACFA">매수전략</td>
            <td style="width:60px;text-align:right">{{D['매수수량2']}}</td>
            <td style="width:80px;text-align:right">{{D['매수가격2']}}</td>
            <td style="width:100px;text-align:right">{{D['매수가액2']}}</td>
        </tr>
        <tr>
            <td style="width:70px;color:#f78181">매도전략</td>
            <td style="width:60px;text-align:right">{{D['매도수량2']}}</td>
            <td style="width:80px;text-align:right">{{D['매도가격2']}}</td>
            <td style="width:100px;text-align:right">{{D['매도가액2']}}</td>
        </tr>
    </table>
</div>
<div style="position:absolute;top:568px;left:180px;font-size:12px;">{{D['증가비율1']}}%</div>
<div style="position:absolute;top:620px;left:180px;font-size:12px;">{{D['증가비율2']}}%</div>
<div style="border:2px solid black;margin-top:10px;">
	<canvas id="myChart_sub"  style="width:355px;height:150px;background-color:#24272d;padding:5px 10px"></canvas>
</div>
</div>

<script src="/sys/chart/chart.min.js"></script>
<script src="/sys/chart/chartjs-plugin-datalabels.min.js"></script>

<script>
    const ctx_side = $id('myChart_side');

    var allot1 = {{D['자산분배1']}};
    var cur_total1 = {{D['자산총액1']}}; 
    var allot2 = {{D['자산분배2']}};
    var cur_total2 = {{D['자산총액2']}}; 
    var increase_rate1 = {{D['증가비율1']}};
    var increase_rate2 = {{D['증가비율2']}};
 
    var allot_val = []
    var cur_total = cur_total1+cur_total2

    var allot_key = Object.keys(allot1);
    var allot_val1 = Object.values(allot1);
    var allot_val2 = Object.values(allot2);
    for(i=0;i<allot_val1.length;i++) {allot_val[i] = allot_val1[i] + allot_val2[i]}

    var allot_sum = allot_val.reduce((acc,cur) => acc+cur,0);
    allot_val.forEach((val,idx,arr)=>{arr[idx]=Math.floor(val/allot_sum*cur_total);});
    
    
    const data_side = {
      labels: allot_key,
      datasets: [{
        label: ' 자산배분비율 ',
        data: allot_val,
        barThickness:60,
        backgroundColor: ['#A67F78','#8F8681','#32435F','#283B42','#69491A','#003E19','#283B42'],
        borderColor: ['#000000','#000000','#000000','#000000','#000000','#000000','#000000'],
        borderWidth: 1
      }]
    };
    
    const config_side = {
      type: 'bar',
      data: data_side,
      plugins:[ChartDataLabels],
      options: {
        animation : {duration:500},
        plugins : { legend: {display:false},
                    tooltip : {enabled:false},
                    datalabels : {color:'white', anchor:'start', align:'end', offset: 3, font:{size:12}}			
        }
        }
    }
    const myChart_side = new Chart(ctx_side, config_side);

    const ctx_sub = $id('myChart_sub');
    
    const data_sub = {
      labels: ['키움','하이'],
      datasets: [
        { label: '키움증권',    data: [100,100], borderColor: '#32435F',      backgroundColor: '#32435F', barThickness:10, },
        { label: '하이투자',    data: [increase_rate1,increase_rate2], borderColor: '#A67F78',      backgroundColor: '#A67F78', barThickness:10, }
      ]
    };
    // </block:setup>
    
    // <block:config:0>
    const config_sub = {
      type: 'bar',
      data: data_sub,
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins : { legend: {display:false},
                    tooltip : {enabled:false},
       }
      },
    }
    const myChart_sub = new Chart(ctx_sub, config_sub);
</script>
{% endblock %}