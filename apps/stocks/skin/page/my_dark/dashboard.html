{% extends D['_skn'] + 'page/my_dark/main_layout_mobile.html' %}

{% block contents_page  %}
<div>
  <div style='font-size:16px;color:#f0f0ab;font-weight:bold;text-align:center'>
  {{D['오늘날자']}}({{D['오늘요일']}}) 투자현황 및 전략
  </div>
  <div style='font-size:14px;color:gray;font-weight:bold;text-align:center;'>
    {% if D['I_guide'] %}
    투자전략 가이드가 업데이트 되지 않았습니다
    {% else %}
    최종 종가 {{D['기준종가']}} / {{D['기준일자']}}({{D['기준요일']}})
    {% endif %}
  </div>

  <div style="border:2px solid black;margin-top:10px;" onclick="$('#show_won').show()">
    <canvas id="myChart_side"  style="width:355px;height:200px;background-color:#24272d;padding:5px 10px"></canvas>
  </div>
  
  <div id='show_won' style="position:absolute;left:14px;top:105px;width:350px;height:200px;padding:20px;background-color:#23262c;opacity:0.9;display:none" onclick="$('#show_won').hide()"></div>


<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
  <div style="font-size:14px;font-weight:700;line-height:30px;border:2px solid black;padding:5px 10px;background-color:black;margin-top:10px;" onclick="$('#v_sub').show()">
      <span style="color:white"> {{D['V_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률1']}}% , {{D['매도시점1']}}%</span>
      <span style="color:#f0f0ab"> {{D['Vtactic']}} </span><br>
      <table>
        <tr>
          <td style="width:70px;color:#f78181">매수전략</td>
          <td style="width:80px;text-align:right">{{D['매수가격1']}}</td>
          <td style="width:60px;text-align:right">{{D['매수수량1']}}</td>
          <td style="width:100px;text-align:right">{{D['매수가액1']}}</td>
        </tr>
        <tr>
          <td style="width:70px;color:#58ACFA">매도전략</td>
          <td style="width:80px;text-align:right">{{D['매도가격1']}}</td>
          <td style="width:60px;text-align:right">{{D['매도수량1']}}</td>
          <td style="width:100px;text-align:right">{{D['매도가액1']}}</td>
        </tr>
      </table>
  </div>

  <div id='v_sub' style="display:none;position:absolute;left:14px;top:318px;width:356px;height:100px;font-size:14px;font-weight:700;line-height:30px;;padding:5px 10px;background-color:black;" onclick="$(this).hide()">
    <span style="color:white"> {{D['V_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률1']}}% , {{D['매도시점1']}}%</span>
    <span style="color:#f0f0ab"> {{D['Vtactic']}} </span><br>
    <table>
      <tr>
          <td style="width:70px;color:#58ACFA">총매수금</td>
          <td style="width:90px;text-align:right">{{D['현매수금1']}}</td>
          <td style="width:90px;text-align:right">{{D['현평가금1']}}</td>
          <td style="width:90px;text-align:right">{{D['현이익금1']}}</td>
      </tr>
      <tr>
          <td style="width:70px;color:yellow">기대수익</td>
          <td style="width:90px;text-align:right">{{D['매도가액1']}}</td>
          <td style="width:100px;text-align:right;color:yellow">{{D['매도차익1']}}</td>
          <td style="width:100px;text-align:right;color:yellow">{{D['매도차원1']}}</td>
      </tr>
  </table>
  </div>

<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

  <div style="font-size:14px;font-weight:700;line-height:30px;border:2px solid black;padding:5px 10px;background-color:black;margin-top:10px;" onclick="$('#r_sub').show()">
      <span style="color:white"> {{D['R_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률2']}}% , {{D['매도시점2']}}%</span>
      <span style="color:#f0f0ab"> {{D['Rtactic']}} </span><br>
      <table>
        <tr>
          <td style="width:70px;color:#f78181">매수전략</td>
          <td style="width:80px;text-align:right">{{D['매수가격2']}}</td>
          <td style="width:60px;text-align:right">{{D['매수수량2']}}</td>
          <td style="width:100px;text-align:right">{{D['매수가액2']}}</td>
        </tr>
        <tr>
          <td style="width:70px;color:#58ACFA">매도전략</td>
          <td style="width:80px;text-align:right">{{D['매도가격2']}}</td>
          <td style="width:60px;text-align:right">{{D['매도수량2']}}</td>
          <td style="width:100px;text-align:right">{{D['매도가액2']}}</td>
        </tr>
      </table>
  </div>

  <div id='r_sub' style="display:none;position:absolute;left:14px;top:432px;width:356px;height:100px;font-size:14px;font-weight:700;line-height:30px;;padding:5px 10px;background-color:black;" onclick="$(this).hide()">
    <span style="color:white"> {{D['R_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률2']}}% , {{D['매도시점2']}}%</span>
    <span style="color:#f0f0ab"> {{D['Rtactic']}} </span><br>
    <table>
      <tr>
          <td style="width:70px;color:#58ACFA">총매수금</td>
          <td style="width:90px;text-align:right">{{D['현매수금2']}}</td>
          <td style="width:90px;text-align:right">{{D['현평가금2']}}</td>
          <td style="width:90px;text-align:right">{{D['현이익금2']}}</td>
      </tr>
      <tr>
          <td style="width:70px;color:yellow">기대수익</td>
          <td style="width:90px;text-align:right">{{D['매도가액2']}}</td>
          <td style="width:100px;text-align:right;color:yellow">{{D['매도차익2']}}</td>
          <td style="width:100px;text-align:right;color:yellow">{{D['매도차원2']}}</td>
      </tr>
  </table>
  </div>

<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

  <div style="font-size:14px;font-weight:700;line-height:30px;border:2px solid black;padding:5px 10px;background-color:black;margin-top:10px;" onclick="$('#s_sub').show()">
    <span style="color:white"> {{D['S_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률3']}}% , {{D['매도시점3']}}%</span>
    <span style="color:#f0f0ab"> {{D['Stactic']}} </span><br>
    <table>
      <tr>
        <td style="width:70px;color:#f78181">매수전략</td>
        <td style="width:80px;text-align:right">{{D['매수가격3']}}</td>
        <td style="width:60px;text-align:right">{{D['매수수량3']}}</td>
        <td style="width:100px;text-align:right">{{D['매수가액3']}}</td>
      </tr>
      <tr>
        <td style="width:70px;color:#58ACFA">매도전략</td>
        <td style="width:80px;text-align:right">{{D['매도가격3']}}</td>
        <td style="width:60px;text-align:right">{{D['매도수량3']}}</td>
        <td style="width:100px;text-align:right">{{D['매도가액3']}}</td>
      </tr>
    </table>
  </div>


  <div id='s_sub' style="display:none;position:absolute;left:14px;top:546px;width:356px;height:100px;font-size:14px;font-weight:700;line-height:30px;;padding:5px 10px;background-color:black;" onclick="$(this).hide()">
  <span style="color:white"> {{D['S_title']}}</span>&nbsp;<span style='color:#747474;'>&nbsp; {{D['현수익률3']}}% , {{D['매도시점3']}}%</span>
  <span style="color:#f0f0ab"> {{D['Stactic']}} </span><br>
  <table>
  <tr>
      <td style="width:70px;color:#58ACFA">총매수금</td>
      <td style="width:90px;text-align:right">{{D['현매수금3']}}</td>
      <td style="width:90px;text-align:right">{{D['현평가금3']}}</td>
      <td style="width:90px;text-align:right">{{D['현이익금3']}}</td>
  </tr>
  <tr>
      <td style="width:70px;color:yellow">기대수익</td>
      <td style="width:90px;text-align:right">{{D['매도가액3']}}</td>
      <td style="width:100px;text-align:right;color:yellow">{{D['매도차익3']}}</td>
      <td style="width:100px;text-align:right;color:yellow">{{D['매도차원3']}}</td>
  </tr>
  </table>
  </div>

  <div style="border:2px solid black;margin-top:10px;">
    <canvas id="myChart_sub"  style="width:355px;height:180px;background-color:#24272d;padding:5px 10px"></canvas>
  </div>
  <div style="position:absolute;top:665px;left:180px;font-size:12px;">{{D['증가비율0']}}%</div>
  <div style="position:absolute;top:699px;left:180px;font-size:12px;">{{D['증가비율1']}}%</div>
  <div style="position:absolute;top:732px;left:180px;font-size:12px;">{{D['증가비율2']}}%</div>
  <div style="position:absolute;top:765px;left:180px;font-size:12px;">{{D['증가비율3']}}%</div>


</div>
<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<script src="/sys/chart/chart.min.js"></script>
<script src="/sys/chart/chartjs-plugin-datalabels.min.js"></script>

<script>
    const ctx_side = $id('myChart_side');

    var allot1 = {{D['자산분배1']}};
    var cur_total1 = {{D['자산총액1']}}; 
    var allot2 = {{D['자산분배2']}};
    var cur_total2 = {{D['자산총액2']}}; 
    var allot3 = {{D['자산분배3']}};
    var cur_total3 = {{D['자산총액3']}}; 
    var increase_rate1 = {{D['증가비율1']}};
    var increase_rate2 = {{D['증가비율2']}};
    var increase_rate3 = {{D['증가비율3']}};
    var increase_rate0 = {{D['증가비율0']}};
    var usd_to_krw = {{D['현재환율']}}
 
    var allot_val = []
    var cur_total = cur_total1+cur_total2+cur_total3

    var allot_key  = Object.keys(allot1);
    var allot_val1 = Object.values(allot1);
    var allot_val2 = Object.values(allot2);
    var allot_val3 = Object.values(allot3);

    for(i=0;i<allot_val1.length;i++) {allot_val[i] = allot_val1[i] + allot_val2[i] + allot_val3[i]};  
    var allot_ori = allot_val.slice();
    var allot_sum0 = allot_ori.reduce((acc,cur) => acc+cur,0); 

    allot_val.forEach((val,idx,arr)=>{arr[idx]=Math.floor((val/allot_sum0)*cur_total);});
    var allot_sum1 = allot_val.reduce((acc,cur) => acc+cur,0);
    //
    string  ="<table style='width:100%'>"
    string +="<tr style='border-bottom:1px solid gray;height:23px;'>"
    string +="<td>Holder</td><td style='text-align:right'>Principal</td>"
    string +="<td style='text-align:right'>Current</td>"
    string +="<td style='text-align:right'>Kor("+usd_to_krw.toLocaleString()+"₩/$)</td></tr>"
    for(i=0;i<allot_key.length;i++) {
      string += "<tr style='height:23px'><td>"+ allot_key[i] +"</td>"
      string += "<td style='text-align:right'>"+ allot_ori[i].toLocaleString() +"</td>"
      string += "<td style='text-align:right'>"+ allot_val[i].toLocaleString() +"</td>"
      string += "<td style='text-align:right'>"+ parseInt(allot_val[i] * usd_to_krw).toLocaleString() +"</td></tr>"
    }
    string += "<tr style='border-top:1px solid gray;height:23px;font-weight:bold'><td>Total</td>"
    string += "<td style='text-align:right'>"+ allot_sum0.toLocaleString() +"</td>"
    string += "<td style='text-align:right'>"+ allot_sum1.toLocaleString() +"</td>"
    string += "<td style='text-align:right'>"+ parseInt(allot_sum1 * usd_to_krw).toLocaleString() +"</td></tr>"
    string += "</table>"
    $("#show_won").html(string)
    //
    
    const data_side = {
      labels: allot_key,
      datasets: [{
        label: ' 자산배분비율 ',
        data: allot_val,
        barThickness:60,
        backgroundColor: ['#A67F78','#8F8681','#32435F','#283B42','#69491A','#003E19','#283B42'],
        borderColor: ['#000000','#000000','#000000','#000000','#000000','#000000','#000000'],
        borderWidth: 1
      }]
    };
    
    const config_side = {
      type: 'bar',
      data: data_side,
      plugins:[ChartDataLabels],
      options: {
        animation : {duration:500},
        plugins : { legend: {display:false},
                    tooltip : {enabled:false},
                    datalabels : {color:'white', anchor:'start', align:'end', offset: 3, font:{size:12}}			
        }
        }
    }
    const myChart_side = new Chart(ctx_side, config_side);

    const ctx_sub = $id('myChart_sub');
    
    const data_sub = {
      labels: ['종합','키움','케비','하이'],
      datasets: [
        { label: '기초현황',    data: [100,100,100,100], borderColor: '#32435F',      backgroundColor: '#32435F', barThickness:8, },
        { label: '수익현황',    data: [increase_rate0,increase_rate1,increase_rate2,increase_rate3], borderColor: '#A67F78',      backgroundColor: '#A67F78', barThickness:8, },
      ]
    };
    const config_sub = {
      type: 'bar',
      data: data_sub,
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins : { legend: {display:false},
                    tooltip : {enabled:false},
       }
      },
    }
    const myChart_sub = new Chart(ctx_sub, config_sub);
</script>
{% endblock %}